<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="globals.css" />
        <link rel="stylesheet" href="styleguide.css" />
        <link rel="stylesheet" href="form.css" />
        <title>申請内容の入力</title>
    </head>
    <body>

        <div class="screen">
            <div class="view">
                <a href="home.html" class="tabler-caret-left"><img class="vector" src="img/vector.svg" /></a>
                <a href="home.html" class="text-wrapper">戻る</a>
            </div>
            <div class="div">申請内容の入力</div>
        </div>

        <!-- 変更: formにid追加 -->
        <form id="dispatchForm">

            <div class="item">
                <label class="label">
                    住所
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="address" required>
            </div>
        
            <div class="item">
                <label class="label">
                    名前（団体名）
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="org_name" required>
            </div>

            <div class="item">
                <label class="label">担当者名</label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="person_name">
            </div>

            <div class="item">
                <label class="label">
                    電話番号
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="tel" required>
            </div>

            <div class="item">
                <label class="label">FAX</label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="fax">
            </div>

            <div class="item">
                <label class="label">
                    派遣日時
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性は既にあり -->
                <input class="inputs" type="datetime-local" name="dispatch_time" required>
            </div>

            <div class="item">
                <label class="label">
                    派遣先の住所
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="dest_address" required>
            </div>

            <div class="item">
                <label class="label">
                    派遣先の会場名
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="dest_place" required>
            </div>

            <div class="item">
                <label class="label">
                    派遣先の電話番号
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="dest_tel" required>
            </div>

            <div class="item">
                <label class="label">派遣先のFAX</label>
                <!-- 変更: name属性追加 -->
                <input class="inputs" type="text" name="dest_fax">
            </div>

            <div class="item">
                <label class="label">
                    申請事由
                    <span class="required-mark">必須</span>
                </label>
                <!-- 変更: name属性追加 -->
                <textarea class="inputs" name="reason" required></textarea>
            </div>

            <div class="btn-area">
                <!-- 変更: onclick削除、type="submit"のみ -->
                <button class="button" type="submit">送信</button>
            </div>

        </form>

        <script>
        // 変更: submitイベントで処理
        document.getElementById('dispatchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            if (form.checkValidity()) {
                const formData = new FormData(form);
                // 変更: fetchでFlaskサーバーにPOST送信
                fetch('http://172.20.10.2:5000/submit', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        alert('申請を送信しました。');
                    } else {
                        alert('送信に失敗しました。');
                    }
                })
                .catch(error => {
                    alert('送信エラー: ' + error);
                });
            } else {
                form.reportValidity();
            }
        });
        </script>
    </body>
</html>